<form class="query-form" id="query-form" data-mage-init='{"validation": {}}'>
    <h2> Got questions?<br> Weâ€™re happy to help out.</h2>
    <fieldset>
            <div class="field required">
                <div class="control">
                    <input name="name" id='name' value="" placeholder="Enter your name" type="text" class="input-text" title="<?php /* @escapeNotVerified */ echo __('Enter your name') ?>" data-validate="{required:true}">
                    <div class="qf-error">Please enter your name</div>
                </div>
            </div>
            <div class="field required">
                <div class="control">
                    <input name="email" id='email' value="" placeholder="Enter your email" type="email" class="input-text" title="<?php /* @escapeNotVerified */ echo __('Enter your email') ?>" data-validate="{required:true}">
                    <div class="qf-error">Please enter your valid email address</div>
                </div>
            </div>
            <div class="field required">
                <div class="control phoneno">
                    <input name="phoneno" id='phoneno' value="" placeholder=" Enter your mobile number" type="number" maxlength="10" class="input-text" title="<?php /* @escapeNotVerified */ echo __('Enter your mobile number') ?>" data-validate="{required:true}" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))" />
                    <div class="qf-error">Please enter your valid mobile number</div>
                </div>
            </div>
        <div class="field required">
            <div class="control">
               
                <input name="whatsapp" class="whatsapp" id="whatsapp"   type="checkbox" class="input-text checkbox" title="<?php /* @escapeNotVerified */ echo __('You can reach me on WhatsApp') ?>">
                <label for="whatsapp" class="label whatsapp-lable">
                    You can reach me on Whatsapp
                </label>
            </div>
        </div>
            <div class="field required">
                <div class="control pincode">
                    <input name="pincode" id="pincode" value="" placeholder="Enter your residence pincode" type="number" maxlength="6" class="input-text" title="<?php /* @escapeNotVerified */ echo __('Enter your residence pincode') ?>" data-validate="{required:true}" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))" />
                    <div class="qf-error">Please enter your valid pincode number</div>
                </div>
            </div>
            <div class="actions-toolbar">
                <div class="primary">
                    <button type="submit" class="action login primary" name="send" id="submit-query">
                        <span><?php /* @escapeNotVerified */ echo __('Submit') ?></span>
                    </button>
                </div>
                <p>By submitting this form, you agree to the <a href="<?= $this->getUrl('privacy-policy') ?>"><?php echo __('Privacy Policy'); ?></a> and <a href="<?= $this->getUrl('terms') ?>"><?php echo __('Terms & Conditions'); ?></a></p>
            </div>
    </fieldset>
</form>
        <div id="query-popup" >
        <h2>Thanks for sharing your details. Our team will reach out to you shortly!</h2>
</div>
<div id="query-popup-error" >
        <h2>Something went Wrong, Try Again!</h2>
</div>
<script>
    require(
        [
            'jquery',
            'Magento_Ui/js/modal/modal'
        ],
        function(
            $,
            modal
        ) {
            var options = {
                type: 'popup',
                modalClass: 'query-form-success',
                responsive: true,
                innerScroll: true,
                buttons: [{
                    text: 'Ok',
                    click: function () {
                        this.closeModal();
                    }
                }]
            };
            var erroroptions = {
                type: 'popup',
                modalClass: 'query-form-error',
                responsive: true,
                innerScroll: true,
                buttons: [{
                    text: 'Ok',
                    click: function () {
                        this.closeModal();
                    }
                }]
            };
            function Queryfromvalidater() {
                var validatename = $("form.query-form #name");
                var validateemail = $("form.query-form #email");
                var validatenumber = $("form.query-form #phoneno");
                var validatepincode = $("form.query-form #pincode");
                var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if (validatename.val().length > 3) {
                    validatename.next().hide();
                } else {
                    validatename.next().show();
                }

                if (regex.test(validateemail.val())) {
                    validateemail.next().hide();
                } else {
                    validateemail.next().show();
                }

                if (validatenumber.val().length == 10) {
                    validatenumber.next().hide();
                } else {
                    validatenumber.next().show();
                }

                if (validatepincode.val().length == 6) {
                    validatepincode.next().hide();
                } else {
                    validatepincode.next().show();
                }
            }
            var popup = modal(options, $('#query-popup'));
            var popuperror = modal(erroroptions, $('#query-popup-error'));
            $('#submit-query').on('click',function (event) {
                event.preventDefault();
                var name = $("#name").val();
                var emailID = $('#email').val();
                var phoneno = $('#phoneno').val();
                if ($('input.whatsapp').is(':checked')) {
                    var  whatsapp = 'yes';
                }else{
                var  whatsapp = 'no';
                }
                var pincode = $('#pincode').val();
                if ($('form.query-form .control.input-has-value').length == 4) {
                    jQuery.ajax({
                        url: "<?php echo $block->getBaseUrl().'query/query/save'?>",
                        data: {name: name,phoneno: phoneno, email: emailID, whatsapp: whatsapp, pincode: pincode},
                        type: "POST",
                        dataType: "json",
                        showLoader: true,
                        success: function(resultJson) {
                            if (resultJson == 'success') {
                                $("#query-popup").modal("openModal");
                                $("form.query-form .control").removeClass("input-has-value");
                                document.getElementById("query-form").reset();
                            }
                            else{
                                $("#query-popup-error").modal("openModal");
                            }
                        }

                    });
                } else {
                    Queryfromvalidater();
                }
            });

        }
    );
</script>
