<?php
use Magento\Cms\Block\BlockByIdentifier;
use Codilar\Store\ViewModel\Overlay;

/** @var BlockByIdentifier $block */
/** @var $viewModel Overlay */
$viewModel = $block->getData("viewModel");
$websiteDetails = $viewModel->getWebsiteDetail();
$mediaUrl = $viewModel->getMediaUrl();
?>
<div class="call-popup" data-mage-init='{"callPopup":{}}'>
        <div class="call-popup-top">
            <div class="call-popup-img">
                <img src='<?php echo $this->getViewFileUrl('images/city-popup-image.png'); ?>' alt="city popup image">
            </div>
            <div class="search-section">
                <h2><?php echo __('Hi There! looking for new furniture?') ?></h2>
                <div class="control">
                        <input id="city-search"
                               type="text"
                               name=""
                               value=""
                               placeholder="<?php echo __('Search your city here') ?>"
                               class="input-text"
                               maxlength="" onkeyup="citySearchFunction()" />
                    </div>
            </div>
        </div>
        <div class="block-title">
            <h3 class="title">
                <span><?php echo __('Please select your city') ?></span>
            </h3>
        </div>
        <div class="box-store-content">
            <ul id="searchable-content">
            <?php
            foreach ($websiteDetails as $key => $value) {
                $imageUrl = $mediaUrl. 'website/icons/' . $value['imageUrl'];
                $storeName = $value['storeName'];
            ?>
            <li>
                <?php if ($imageUrl): ?>
                    <div class="store-image">
                        <img src="http://homelane.local/media/website/icons/stores/1/city-placeholder.png" alt="<?php echo $storeName ?>" title="<?php echo $storeName ?>" class="img-responsive"  width="200" height="200"/>
                    </div>
                <?php endif ?>
                <?php if($storeName): ?>
                    <div class="store-name">
                        <a target="_blank" href="<?php echo $storeName ?>">
                            <?php echo $storeName ?>
                        </a>
                    </div>
                <?php endif ?>
            </li>
            <?php } ?>
        </ul>
    </div>
</div>
<script type="text/javascript">
        function citySearchFunction() {
            var input, filter, ul, li, a, i, txtValue;
            input = document.getElementById("city-search");
            filter = input.value.toUpperCase();
            ul = document.getElementById("searchable-content");
            li = ul.getElementsByTagName("li");
            for (i = 0; i < li.length; i++) {
                a = li[i].getElementsByTagName("a")[0];
                txtValue = a.textContent || a.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }
</script>
